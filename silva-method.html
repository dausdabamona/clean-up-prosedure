<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silva Method - Mind Control Techniques</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üßò</text></svg>">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ==================== SILVA THEME ==================== */
    :root {
      --silva-primary: #6B4E9B;
      --silva-secondary: #9B6B9B;
      --silva-accent: #E8D4F0;
      --silva-gradient: linear-gradient(135deg, #6B4E9B, #9B6B9B);
      --silva-light: #F5EEF8;
    }
    .header { background: var(--silva-gradient); }
    .card-header { background: var(--silva-gradient); }
    .btn-primary { background: var(--silva-gradient); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(107, 78, 155, 0.3); }

    /* Back link */
    .back-link { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--white); text-decoration: none; font-size: 1.5rem; opacity: 0.8; }
    .back-link:hover { opacity: 1; }

    /* Tabs */
    .nav-tabs { display: flex; background: var(--white); padding: 0.5rem; gap: 0.25rem; overflow-x: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .nav-tab { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 0.6rem 0.4rem; border: none; background: none; cursor: pointer; border-radius: 8px; transition: all 0.3s; min-width: 70px; }
    .nav-tab .icon { font-size: 1.3rem; margin-bottom: 0.2rem; }
    .nav-tab span:not(.icon) { font-size: 0.65rem; color: var(--text-light); }
    .nav-tab.active { background: var(--silva-primary); }
    .nav-tab.active span { color: var(--white); }

    /* Main Content */
    .main-content { max-width: 600px; margin: 0 auto; padding: 1rem; padding-bottom: 2rem; }

    /* Tab Content */
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Level Badge */
    .level-badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.65rem; font-weight: 600; margin-left: 0.5rem; }
    .level-1 { background: #D5F5E3; color: #196F3D; }
    .level-2 { background: #D4E6F1; color: #1A5276; }
    .level-3 { background: #FCF3CF; color: #9A7D0A; }
    .level-4 { background: #FADBD8; color: #922B21; }

    /* Technique Card */
    .technique-card { background: var(--white); border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem; box-shadow: var(--shadow); cursor: pointer; transition: all 0.3s; border-left: 4px solid var(--silva-primary); }
    .technique-card:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
    .technique-card:active { transform: scale(0.98); }
    .technique-header { display: flex; align-items: center; gap: 0.75rem; }
    .technique-icon { font-size: 2rem; }
    .technique-info { flex: 1; }
    .technique-title { font-weight: 700; color: var(--silva-primary); font-size: 1rem; margin-bottom: 0.25rem; }
    .technique-desc { font-size: 0.8rem; color: var(--text-light); }
    .technique-meta { display: flex; gap: 0.5rem; margin-top: 0.25rem; }
    .technique-meta span { font-size: 0.7rem; color: var(--text-muted); }
    .technique-arrow { color: var(--text-light); font-size: 1.2rem; }

    /* Category Header */
    .category-header { display: flex; align-items: center; gap: 0.5rem; margin: 1.5rem 0 0.75rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid var(--silva-primary); }
    .category-header .emoji { font-size: 1.5rem; }
    .category-header h3 { font-size: 1rem; color: var(--silva-primary); font-weight: 700; margin: 0; }

    /* Quick Start Card */
    .quick-start { background: linear-gradient(135deg, var(--silva-light), #E8D4F0); border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; border: 2px solid var(--silva-secondary); }
    .quick-start h3 { color: var(--silva-primary); font-size: 1rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }

    /* Info Box */
    .info-box { background: linear-gradient(135deg, #fef9e7, #fcf3cf); border: 1px solid #f7dc6f; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; }
    .info-box h4 { color: #9a7d0a; font-size: 0.9rem; margin-bottom: 0.5rem; }
    .info-box p { font-size: 0.8rem; color: var(--text-dark); line-height: 1.6; }
    .info-box ul { margin-left: 1rem; font-size: 0.8rem; line-height: 1.8; }

    /* Quote Card */
    .quote-card { background: linear-gradient(135deg, #f5f7fa, #e4e8ec); border-radius: 10px; padding: 1rem; text-align: center; margin-bottom: 1rem; }
    .quote-text { font-style: italic; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.9rem; }
    .quote-author { font-size: 0.75rem; color: var(--text-light); }

    /* Progress Section */
    .progress-section { margin-top: 1.5rem; }
    .progress-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
    .progress-item { background: var(--white); border-radius: 8px; padding: 0.5rem; text-align: center; box-shadow: var(--shadow); }
    .progress-item.done { background: #d5f5e3; }
    .progress-emoji { font-size: 1.5rem; }
    .progress-count { font-size: 0.7rem; color: var(--text-light); }

    /* Level Progress */
    .level-progress { background: var(--white); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; box-shadow: var(--shadow); }
    .level-progress h4 { font-size: 0.9rem; color: var(--silva-primary); margin-bottom: 0.75rem; }
    .level-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 0; border-bottom: 1px solid var(--border); }
    .level-item:last-child { border-bottom: none; }
    .level-num { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.8rem; }
    .level-num.l1 { background: #D5F5E3; color: #196F3D; }
    .level-num.l2 { background: #D4E6F1; color: #1A5276; }
    .level-num.l3 { background: #FCF3CF; color: #9A7D0A; }
    .level-num.l4 { background: #FADBD8; color: #922B21; }
    .level-name { flex: 1; font-size: 0.85rem; }
    .level-check { color: #27AE60; font-size: 1.2rem; }

    /* History Item */
    .history-item { background: var(--white); border-radius: 10px; padding: 0.75rem; margin-bottom: 0.5rem; box-shadow: var(--shadow); border-left: 4px solid var(--silva-secondary); }
    .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .history-title { font-weight: 600; color: var(--silva-primary); font-size: 0.9rem; }
    .history-date { font-size: 0.7rem; color: var(--text-light); }
    .history-notes { font-size: 0.8rem; color: var(--text-dark); }

    /* Empty State */
    .empty-state { text-align: center; padding: 2rem; color: var(--text-light); }
    .empty-state .emoji { font-size: 3rem; margin-bottom: 0.5rem; }

    /* Responsive */
    @media(max-width:480px) {
      .header h1 { font-size: 1.2rem; }
      .nav-tab { padding: 0.5rem 0.25rem; min-width: 60px; }
      .nav-tab .icon { font-size: 1.1rem; }
      .technique-title { font-size: 0.95rem; }
      .progress-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="sedona-app.html" class="back-link">‚Üê</a>
    <h1>üßò Silva Method</h1>
    <p>Mind Control Techniques</p>
  </header>

  <nav class="nav-tabs">
    <button class="nav-tab active" data-tab="beranda"><span class="icon">üè†</span><span>Beranda</span></button>
    <button class="nav-tab" data-tab="level1"><span class="icon">üå±</span><span>Dasar</span></button>
    <button class="nav-tab" data-tab="level2"><span class="icon">‚ö°</span><span>Inti</span></button>
    <button class="nav-tab" data-tab="level3"><span class="icon">üí°</span><span>Solusi</span></button>
    <button class="nav-tab" data-tab="level4"><span class="icon">üîÆ</span><span>Advance</span></button>
    <button class="nav-tab" data-tab="history"><span class="icon">üìú</span><span>History</span></button>
  </nav>

  <main class="main-content">

    <!-- ==================== TAB: BERANDA ==================== -->
    <section class="tab-content active" id="berandaTab">
      <!-- Quick Start -->
      <div class="quick-start">
        <h3><span>üöÄ</span> Mulai Latihan</h3>
        <button class="btn btn-primary btn-block" onclick="startSilva('basicRelaxation')" style="margin-bottom:0.5rem">
          üßò Relaksasi Dasar (3-to-1)
        </button>
        <button class="btn btn-secondary btn-block" onclick="startSilva('threeFingers')">
          ‚úåÔ∏è Three Fingers Technique
        </button>
      </div>

      <!-- Info Box -->
      <div class="info-box">
        <h4>üßò Apa itu Silva Method?</h4>
        <p>Metode pengendalian pikiran yang dikembangkan oleh Jos√© Silva untuk mengakses level Alpha otak (7-14 Hz) di mana:</p>
        <ul>
          <li><strong>Relaksasi:</strong> Tubuh dan pikiran rileks namun waspada</li>
          <li><strong>Kreativitas:</strong> Akses ke pikiran bawah sadar</li>
          <li><strong>Programming:</strong> Memprogram tujuan dan perubahan</li>
          <li><strong>Intuisi:</strong> Mengembangkan kemampuan intuitif</li>
        </ul>
      </div>

      <!-- Quote -->
      <div class="quote-card">
        <p class="quote-text" id="silvaQuote">"You have the ability to change your life with your mind."</p>
        <p class="quote-author" id="silvaQuoteAuthor">‚Äî Jos√© Silva</p>
      </div>

      <!-- Level Progress -->
      <div class="level-progress">
        <h4>üìä Progress Level</h4>
        <div class="level-item">
          <div class="level-num l1">1</div>
          <span class="level-name">Foundation (Dasar)</span>
          <span class="level-check" id="level1Check"></span>
        </div>
        <div class="level-item">
          <div class="level-num l2">2</div>
          <span class="level-name">Core Techniques (Inti)</span>
          <span class="level-check" id="level2Check"></span>
        </div>
        <div class="level-item">
          <div class="level-num l3">3</div>
          <span class="level-name">Problem Solving (Solusi)</span>
          <span class="level-check" id="level3Check"></span>
        </div>
        <div class="level-item">
          <div class="level-num l4">4</div>
          <span class="level-name">Advanced (Lanjutan)</span>
          <span class="level-check" id="level4Check"></span>
        </div>
      </div>

      <!-- Stats -->
      <div class="progress-section">
        <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:var(--silva-primary)">üìà Statistik</h4>
        <div class="progress-grid">
          <div class="progress-item">
            <div class="progress-emoji">üßò</div>
            <div class="progress-count"><span id="totalSessions">0</span> sesi</div>
          </div>
          <div class="progress-item">
            <div class="progress-emoji">üéØ</div>
            <div class="progress-count"><span id="techniquesMastered">0</span>/13 teknik</div>
          </div>
          <div class="progress-item">
            <div class="progress-emoji">üî•</div>
            <div class="progress-count"><span id="currentStreak">0</span> streak</div>
          </div>
          <div class="progress-item">
            <div class="progress-emoji">‚è±Ô∏è</div>
            <div class="progress-count"><span id="totalMinutes">0</span> menit</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ==================== TAB: LEVEL 1 - FOUNDATION ==================== -->
    <section class="tab-content" id="level1Tab">
      <div class="info-box" style="margin-bottom:1rem">
        <h4>üå± Level 1: Foundation (Dasar)</h4>
        <p>Pelajari teknik dasar untuk memasuki level Alpha. Kuasai ini sebelum lanjut ke level berikutnya.</p>
      </div>

      <div class="technique-card" onclick="startSilva('basicRelaxation')">
        <div class="technique-header">
          <div class="technique-icon">üßò</div>
          <div class="technique-info">
            <div class="technique-title">Relaksasi Dasar (3-to-1)<span class="level-badge level-1">DASAR</span></div>
            <div class="technique-desc">Teknik dasar memasuki Alpha dengan countdown 3-2-1</div>
            <div class="technique-meta"><span>‚è±Ô∏è 10 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('countdownDeepening')">
        <div class="technique-header">
          <div class="technique-icon">üî¢</div>
          <div class="technique-info">
            <div class="technique-title">Countdown Deepening (10-1)<span class="level-badge level-1">DASAR</span></div>
            <div class="technique-desc">Masuk ke Alpha lebih dalam dengan hitungan 10-1</div>
            <div class="technique-meta"><span>‚è±Ô∏è 12 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('mentalScreen')">
        <div class="technique-header">
          <div class="technique-icon">üì∫</div>
          <div class="technique-info">
            <div class="technique-title">Mental Screen (Layar Mental)<span class="level-badge level-1">DASAR</span></div>
            <div class="technique-desc">Membuat layar visualisasi untuk programming</div>
            <div class="technique-meta"><span>‚è±Ô∏è 15 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>
    </section>

    <!-- ==================== TAB: LEVEL 2 - CORE ==================== -->
    <section class="tab-content" id="level2Tab">
      <div class="info-box" style="margin-bottom:1rem">
        <h4>‚ö° Level 2: Core Techniques (Teknik Inti)</h4>
        <p>Teknik inti Silva Method untuk anchoring dan programming pikiran bawah sadar.</p>
      </div>

      <div class="technique-card" onclick="startSilva('threeFingers')">
        <div class="technique-header">
          <div class="technique-icon">‚úåÔ∏è</div>
          <div class="technique-info">
            <div class="technique-title">Three Fingers Technique<span class="level-badge level-2">INTI</span></div>
            <div class="technique-desc">Anchor untuk mengakses Alpha kapan saja</div>
            <div class="technique-meta"><span>‚è±Ô∏è 15 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('alphaProgramming')">
        <div class="technique-header">
          <div class="technique-icon">üéØ</div>
          <div class="technique-info">
            <div class="technique-title">Alpha Programming<span class="level-badge level-2">INTI</span></div>
            <div class="technique-desc">Memprogram tujuan dan afirmasi di level Alpha</div>
            <div class="technique-meta"><span>‚è±Ô∏è 20 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('centeringExercise')">
        <div class="technique-header">
          <div class="technique-icon">üåÄ</div>
          <div class="technique-info">
            <div class="technique-title">Centering Exercise<span class="level-badge level-2">INTI</span></div>
            <div class="technique-desc">Latihan relaksasi mendalam (Long Relaxation)</div>
            <div class="technique-meta"><span>‚è±Ô∏è 25 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>
    </section>

    <!-- ==================== TAB: LEVEL 3 - PROBLEM SOLVING ==================== -->
    <section class="tab-content" id="level3Tab">
      <div class="info-box" style="margin-bottom:1rem">
        <h4>üí° Level 3: Problem Solving (Pemecahan Masalah)</h4>
        <p>Teknik-teknik untuk mendapatkan solusi dan mencapai tujuan melalui visualisasi di Alpha.</p>
      </div>

      <div class="technique-card" onclick="startSilva('glassOfWater')">
        <div class="technique-header">
          <div class="technique-icon">ü•õ</div>
          <div class="technique-info">
            <div class="technique-title">Glass of Water Technique<span class="level-badge level-3">SOLUSI</span></div>
            <div class="technique-desc">Mendapatkan solusi melalui mimpi atau intuisi</div>
            <div class="technique-meta"><span>‚è±Ô∏è 10 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('mirrorOfMind')">
        <div class="technique-header">
          <div class="technique-icon">ü™û</div>
          <div class="technique-info">
            <div class="technique-title">Mirror of the Mind<span class="level-badge level-3">SOLUSI</span></div>
            <div class="technique-desc">Visualisasi cermin biru-putih untuk goal achievement</div>
            <div class="technique-meta"><span>‚è±Ô∏è 20 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('mentalVideo')">
        <div class="technique-header">
          <div class="technique-icon">üé¨</div>
          <div class="technique-info">
            <div class="technique-title">Mental Video<span class="level-badge level-3">SOLUSI</span></div>
            <div class="technique-desc">Membuat film mental tentang kesuksesan</div>
            <div class="technique-meta"><span>‚è±Ô∏è 20 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>
    </section>

    <!-- ==================== TAB: LEVEL 4 - ADVANCED ==================== -->
    <section class="tab-content" id="level4Tab">
      <div class="info-box" style="margin-bottom:1rem">
        <h4>üîÆ Level 4: Advanced (Teknik Lanjutan)</h4>
        <p>Teknik-teknik advance untuk menguasai pikiran, mimpi, kebiasaan, dan intuisi.</p>
      </div>

      <div class="technique-card" onclick="startSilva('dreamControl')">
        <div class="technique-header">
          <div class="technique-icon">üåô</div>
          <div class="technique-info">
            <div class="technique-title">Dream Control<span class="level-badge level-4">ADVANCE</span></div>
            <div class="technique-desc">Memprogram dan mengingat mimpi untuk insight</div>
            <div class="technique-meta"><span>‚è±Ô∏è 15 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('habitControl')">
        <div class="technique-header">
          <div class="technique-icon">üîÑ</div>
          <div class="technique-info">
            <div class="technique-title">Habit Control<span class="level-badge level-4">ADVANCE</span></div>
            <div class="technique-desc">Mengubah kebiasaan buruk dan membangun baru</div>
            <div class="technique-meta"><span>‚è±Ô∏è 20 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('healingVisualization')">
        <div class="technique-header">
          <div class="technique-icon">üíö</div>
          <div class="technique-info">
            <div class="technique-title">Healing Visualization<span class="level-badge level-4">ADVANCE</span></div>
            <div class="technique-desc">Visualisasi untuk mendukung kesehatan</div>
            <div class="technique-meta"><span>‚è±Ô∏è 20 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>

      <div class="technique-card" onclick="startSilva('caseWorking')">
        <div class="technique-header">
          <div class="technique-icon">üîÆ</div>
          <div class="technique-info">
            <div class="technique-title">Case Working (Intuisi)<span class="level-badge level-4">ADVANCE</span></div>
            <div class="technique-desc">Mengembangkan kemampuan intuitif</div>
            <div class="technique-meta"><span>‚è±Ô∏è 25 menit</span></div>
          </div>
          <div class="technique-arrow">‚Üí</div>
        </div>
      </div>
    </section>

    <!-- ==================== TAB: HISTORY ==================== -->
    <section class="tab-content" id="historyTab">
      <h3 style="font-size:1rem;color:var(--silva-primary);margin-bottom:1rem">üìú History Latihan Silva</h3>
      <div id="historyContainer">
        <div class="empty-state">
          <div class="emoji">üì≠</div>
          <p>Belum ada history latihan.</p>
          <p style="font-size:0.8rem">Mulai latihan pertamamu!</p>
        </div>
      </div>
    </section>

  </main>

  <!-- Releasing Modal -->
  <div class="releasing-modal" id="releasingModal"></div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts -->
  <script src="common.js"></script>
  <script src="releasing-engine.js"></script>
  <script src="silva-scripts.js"></script>

  <script>
    // ==================== TAB NAVIGATION ====================
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;

        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Show content
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabId + 'Tab').classList.add('active');

        // Load data if needed
        if (tabId === 'history') loadHistory();
      });
    });

    // ==================== RANDOM QUOTE ====================
    function updateQuote() {
      if (typeof getRandomSilvaQuote === 'function') {
        const quote = getRandomSilvaQuote();
        document.getElementById('silvaQuote').textContent = '"' + quote.text + '"';
        document.getElementById('silvaQuoteAuthor').textContent = '‚Äî ' + quote.author;
      }
    }

    // ==================== PROGRESS ====================
    function loadProgress() {
      const history = JSON.parse(localStorage.getItem('silva_history') || '[]');

      // Count unique techniques
      const uniqueTechniques = [...new Set(history.map(h => h.scriptId))];

      // Count by level
      const level1 = ['basicRelaxation', 'countdownDeepening', 'mentalScreen'];
      const level2 = ['threeFingers', 'alphaProgramming', 'centeringExercise'];
      const level3 = ['glassOfWater', 'mirrorOfMind', 'mentalVideo'];
      const level4 = ['dreamControl', 'habitControl', 'healingVisualization', 'caseWorking'];

      const hasLevel1 = level1.some(t => uniqueTechniques.includes(t));
      const hasLevel2 = level2.some(t => uniqueTechniques.includes(t));
      const hasLevel3 = level3.some(t => uniqueTechniques.includes(t));
      const hasLevel4 = level4.some(t => uniqueTechniques.includes(t));

      // Update level checks
      document.getElementById('level1Check').textContent = hasLevel1 ? '‚úì' : '';
      document.getElementById('level2Check').textContent = hasLevel2 ? '‚úì' : '';
      document.getElementById('level3Check').textContent = hasLevel3 ? '‚úì' : '';
      document.getElementById('level4Check').textContent = hasLevel4 ? '‚úì' : '';

      // Update stats
      document.getElementById('totalSessions').textContent = history.length;
      document.getElementById('techniquesMastered').textContent = uniqueTechniques.length;

      // Calculate streak
      const streak = calculateStreak(history);
      document.getElementById('currentStreak').textContent = streak;

      // Estimate total minutes (rough calculation)
      const totalMinutes = history.length * 15; // Average 15 min per session
      document.getElementById('totalMinutes').textContent = totalMinutes;
    }

    function calculateStreak(history) {
      if (history.length === 0) return 0;

      let streak = 0;
      const today = new Date().toDateString();
      const dates = history.map(h => new Date(h.timestamp).toDateString());
      const uniqueDates = [...new Set(dates)].sort((a, b) => new Date(b) - new Date(a));

      for (let i = 0; i < uniqueDates.length; i++) {
        const expectedDate = new Date();
        expectedDate.setDate(expectedDate.getDate() - i);
        if (uniqueDates[i] === expectedDate.toDateString()) {
          streak++;
        } else {
          break;
        }
      }
      return streak;
    }

    // ==================== HISTORY ====================
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('silva_history') || '[]');
      const container = document.getElementById('historyContainer');

      if (history.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="emoji">üì≠</div>
            <p>Belum ada history latihan.</p>
            <p style="font-size:0.8rem">Mulai latihan pertamamu!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = history.slice().reverse().map(h => `
        <div class="history-item">
          <div class="history-header">
            <div class="history-title">${h.title || h.scriptId}</div>
            <div class="history-date">${formatDate(h.timestamp)}</div>
          </div>
          ${h.notes ? `<div class="history-notes">${h.notes}</div>` : ''}
        </div>
      `).join('');
    }

    function formatDate(timestamp) {
      if (!timestamp) return '-';
      const d = new Date(timestamp);
      return d.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    // ==================== SAVE TO HISTORY ====================
    window.startSilva = function(scriptId) {
      if (typeof ReleasingEngine !== 'undefined') {
        if (!ReleasingEngine.getScript(scriptId) && silvaScripts[scriptId]) {
          ReleasingEngine.getScripts()[scriptId] = silvaScripts[scriptId];
        }

        ReleasingEngine.init({
          onComplete: function(result) {
            // Save to history
            const history = JSON.parse(localStorage.getItem('silva_history') || '[]');
            history.push({
              scriptId: scriptId,
              title: silvaScripts[scriptId]?.title || scriptId,
              timestamp: new Date().toISOString(),
              notes: result?.insight || ''
            });
            localStorage.setItem('silva_history', JSON.stringify(history));

            loadProgress();
            showToast('Sesi ' + (silvaScripts[scriptId]?.title || scriptId) + ' selesai!', 'success');
          }
        });

        ReleasingEngine.startReleasing(scriptId);
      } else {
        showToast('ReleasingEngine tidak tersedia', 'error');
      }
    };

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', () => {
      updateQuote();
      loadProgress();
    });
  </script>
</body>
</html>
